{% extends "front/base.html.twig" %}
{% block title %}{% trans %}SEARCH RESULT TITLE{% endtrans %}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin=""/>
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />
{% endblock %}

{% block content %}
    <section class="listing">
        <header>{% trans %}SEARCH RESULT{% endtrans %}</header>
        <div id="result-map"></div>
        {% for immo in result %}
            <article class="pure-g realestate">
                <div class="pure-u-1-8">
                    <figure>
                        <a href="{{ path('app_buy_detail') }}">
                            <img class="pure-img endmargin" src="/upload/placeholder.jpg"/>
                        </a>
                    </figure>
                </div>
                <div class="pure-u-3-4">
                    <figcaption>
                        <a href="{{ path('app_buy_detail') }}">
                            <h3>{{ immo.title }}</h3>
                        </a>
                        <a href="{{ path('app_buy_detail') }}">
                            <p>{{ immo.description }}</p>
                        </a>
                        <nav class="pure-g navbar">
                            <div class="pure-u-1-3">{% trans %}COMMENT VIEW{% endtrans %} (0)</div>
                            <div class="pure-u-1-3">{% trans %}VIRTUAL VISIT{% endtrans %}</div>
                            <div class="pure-u-1-3">{% trans %}WATCH ON MAP{% endtrans %}</div>
                        </nav>
                        <ul class="tags">
                            {% for tag in immo.tag %}
                                <li style="color: hsl({{ crc_hue(tag) }}, 70%, 25%); background-color: hsl({{ crc_hue(tag) }}, 70%, 85%)">
                                    {{ tag }}
                                </li>
                            {% endfor %}
                        </ul>
                    </figcaption>
                </div>
                <div class="pure-u-1-8">
                    <nav class="actions">
                        <h3>{{ immo.price|format_currency(immo.currency, locale='fr', attrs={fraction_digit: 0}) }}</h3>
                        <a href="#"><img src="{{ asset('img/arrowright.svg') }}"/><br/>
                            {% trans %}RDV SETTING{% endtrans %}</a>
                    </nav>
                </div>
            </article>
        {% endfor %}
        <footer></footer>
    </section>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>    
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
    <script>
        var map = L.map('result-map', {
            fullscreenControl: true
        });

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        {% for immo in result %}
            L.marker([{{ immo.latitude }}, {{ immo.longitude }}]).addTo(map)
                    .bindPopup('<img class="pure-img endmargin" src="/upload/placeholder.jpg"/><br/>{{ immo.title|e('js') }}');
        {% endfor %}

            map.fitBounds({{ result.boundaries|json_encode() }});
    </script>
{% endblock %}